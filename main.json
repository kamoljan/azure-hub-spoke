{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    // "adminUser": {
    //   "type": "string"
    // },
    // "adminPassword": {
    //   "type": "string"
    // },
    "location": {
      "type": "string"
    },
    "prefix": {
      "type": "string"
    },
    "virtualNetworkName": {
      "type": "string"
    },
    "virtualNetworkAddressPrefix": {
      "type": "string"
    },
    "hubName": { // ne-khub-dev
      "type": "string"
    }
  },
  "variables": {
    "sharedTemplateUrl": "[uri(deployment().properties.templateLink.uri, 'nested/shared.json')]",
    "diagStorageAccountName": "[substring(concat(parameters('prefix'), 'dg', uniqueString(resourceGroup().id)),0,23)]",
    "hub": {
      "name": "[parameters('hubName')]",
      "addressPrefix": "10.5.0.0/16",
      "subnets": {
        "managementSubnet": {
          "name": "managementSN",
          "addressPrefix": "10.5.0.0/26",
          "nsg": "managementNSG"
        }
      }
    },
    "resources": [
      {
        "type": "Microsoft.Resources/deployments",
        "name": "sharedTemplateLink",
        "apiVersion": "2016-09-01",
        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "[variables('sharedTemplateUrl')]"
          },
          "parameters": {
            "location": {
              "value": "[parameters('location')]"
            },
            "diagStorageAccountName": {
              "value": "[variables('diagStorageAccountName')]"
            },
            "virtualNetworkName": {
              "value": "[parameters('virtualNetworkName')]"
            },
            "virtualNetworkAddressPrefix": {
              "value": "[parameters('virtualNetworkAddressPrefix')]"
            }
          }
        }
      }
    ],
    "outputs": {}
  }